angular.module("rt.popup",[]).factory("Popup",["$window","$document","$timeout","$compile","$parse",function(a,b,c,d,e){function f(a){m&&!$.contains(m.el[0],a.target)&&g()}function g(){if(m){var a=m;m=null,c(function(){e(a.options.popupHidden)(a.scope),a.el.hide().remove(),b.off("click",f)})}}function h(a,b){for(var c in b)a[c]||(a[c]=b[c])}function i(a,b,d){h(d,{popupPlacement:"right",popupClass:"",popupShown:"",popupHidden:"",popupOverlap:5}),b.popupView=d.popupShow,b.hidePopover=g,c(function(){l(a,b,d)})}function j(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].documentElement.scrollLeft)}}function k(c,d,g,h,i){var k=null,l=null,m=null,n=j(d),p=i.popupPlacement,q=a.innerHeight-2*o,r=i.popupOverlap;if("right"===p)m={top:n.top+n.height/2,left:n.left+n.width-r},k={top:m.top-g.height()/2,left:m.left},k.top=Math.max(o,k.top),l={top:m.top-k.top};else if("left"===p)m={top:n.top+n.height/2,left:n.left+r-2},k={top:m.top-g.height()/2,left:m.left-g.width()},k.top=Math.max(o,k.top),l={top:m.top-k.top};else if("bottom"===p)m={top:n.top+n.height,left:n.left+n.width/2},k={top:m.top-r,left:m.left-g.width()/2},k.left=Math.max(o,k.left),q-=k.top,l={left:m.left-k.left};else if("bottom-left"===p)m={top:n.top+n.height,left:n.left+g.width()/2},k={top:m.top-r,left:m.left-g.width()/2},k.left=Math.max(o,k.left),q-=k.top,p="bottom",l={left:m.left-k.left};else{if("top"!==p)throw new Error("Unsupported placement "+p);m={top:n.top-g.outerHeight(),left:n.left+n.width/2},k={top:m.top+r,left:m.left-g.width()/2},k.left=Math.max(o,k.left),q-=k.top,l={left:m.left-k.left}}g.removeClass("left right bottom top"),g.addClass(p),g.css({top:k.top+"px",left:k.left+"px",display:"block",maxHeight:q});var s=g.find(".popover-title"),t=g.find(".popover-content"),u=g.find(".popover-footer");t.css({maxHeight:q-u.outerHeight()-s.outerHeight()-4,overflow:"auto"}),l&&h.css(l),g.removeClass("hide"),b.on("click",f),e(i.popupShown)(c)}function l(a,e,f){var g=d(n)(e);m={el:g,options:f,scope:e};var h=b.find("body");h.append(g);var i=$("<div />",{"class":"arrow"});g.children(".arrow").remove(),g.append(i),e.$reposition=function(){var b=f.popupClass;b&&g.addClass(b),c(function(){k(e,a,g,i,f)})}}var m=null,n='<div class="popover"><div ng-include="popupView" onload="$reposition()"></div></div>',o=10;return{show:i,close:g}}]).directive("popupShow",["Popup","$parse","$timeout",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){e.click(function(){c(function(){a.close();var c=b(f.popupIf||"true");c(d)&&a.show(e,d,f)})})}}}]).directive("popupAutoShow",["Popup","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){c.$watch(e.popupAutoShow,function(f){if(f){a.close();var g=b(e.popupIf||"true");g(c)&&a.show(d,c,e)}})}}}]);
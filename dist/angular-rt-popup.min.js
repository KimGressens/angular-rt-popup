var mod=angular.module("rt.popup",[]);mod.factory("Popup",["$window","$document","$timeout","$compile",function(a,b,c,d){function e(a){$.contains(k[0],a.target)||f()}function f(){k&&c(function(){k.hide().remove(),b.off("click",e)})}function g(a,b,d,e,g){e||(e="right"),g||(g=""),d.popupView=a,d.hidePopover=f,c(function(){j(b,d,e,g)})}function h(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].documentElement.scrollLeft)}}function i(c,d,f,g,i){var j=null,k=null,l=null,m=h(c),p=a.innerHeight-2*n;if("right"===g)l={top:m.top+m.height/2,left:m.width-o},j={top:l.top-d.height()/2,left:l.left},j.top=Math.max(n,j.top),k={top:l.top-j.top};else if("left"===g)l={top:m.top+m.height/2,left:m.left+o-2},j={top:l.top-d.height()/2,left:l.left-d.width()},j.top=Math.max(n,j.top),k={top:l.top-j.top};else{if("bottom"!==g)throw new Error("Unsupported placement "+g);l={top:m.top+m.height,left:m.left+m.width/2},j={top:l.top-o,left:l.left-d.width()/2},j.left=Math.max(n,j.left),p-=j.top,k={left:l.left-j.left}}d.removeClass("left right bottom top"),d.addClass(g),i&&d.addClass(i),d.css({top:j.top+"px",left:j.left+"px",display:"block",maxHeight:p});var q=d.find(".popover-title"),r=d.find(".popover-content"),s=d.find(".popover-footer");r.css({maxHeight:p-s.outerHeight()-q.outerHeight()-4,overflow:"auto"}),k&&f.css(k),d.removeClass("hide"),b.on("click",e)}function j(a,e,f,g){var h=d(m)(e);k=h;var j=b.find("body");j.append(h);var l=$("<div />",{"class":"arrow"});h.children(".arrow").remove(),h.append(l),e.$reposition=function(){c(function(){i(a,h,l,f,g)})}}var k=null,l={},m='<div class="popover"><div ng-include="popupView" onload="$reposition()"></div></div>',n=10,o=5;return{register:function(a,b,c){a.addClass("popover hide"),l[b]={element:a,scope:c.$new()}},show:g,close:f}}]),mod.directive("popupShow",["Popup","$parse","$timeout",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){e.click(function(){c(function(){a.close();var c=b(f.popupIf||"true");c(d)&&a.show(f.popupShow,e,d,f.popupPlacement,f.popupClass)})})}}}]);